Number.prototype.between=function(a,b){return this<a?a:this>b?b:+this},$.fn.scroll=function(a){a=a||{};var b=this[0],c=this.css("overflow","hidden"),d=c.width(),e=c.height(),f=c.offset(),g=f.top,h=-e;c.children("img").each(function(){$(this).on("load",function(){$(this).css({position:"relative",float:"left"}),h+=$(this).height()})});var i=$(a.bar);i.length&&(i.detach().appendTo("body"),i.css({position:"absolute",left:f.left+d}));var m,o,p,q,j=a.elastic,k=!1,l=e-i.height(),n=0,r=function(a,b,c){var d=+(b||new Date)-+a;return c?d/1e3:d},s=1,t=1,u=function(a){return isNaN(a.pageY)&&(a=a.originalEvent,a=a.touches[0]||a.changedTouches[0]),a.pageY},v=function(a){"function"==typeof a.preventDefault&&a.preventDefault(),"function"==typeof a.stopPropagation&&a.stopPropagation(),"function"==typeof a.stopImmediatePropagation&&a.stopImmediatePropagation()},w=function(a){v(a),n=u(a),m=b.scrollTop,p=new Date,c.on(A,C)},x=a.arrayFnSpaces||[function(){}],y=x[0];x[0]=0,x.push(1/0);var z=x.length,k=function(a){for(var b=0;b<z;b++)if(a<x[b])return b;return z},A="mousemove touchmove",B=!1,C=function(a){B||(B=!0,window.requestAnimationFrame(function(){q=new Date,o=n-u(a),c.scrollTop((m+o).between(0,h)),i.css("top",b.scrollTop/h*l+g),t=k(b.scrollTop),t!==s&&(y(t,s),s=t),B=!1}))},D=function(a){if(c.off(A,C),j&&r(q)<200){var b=r(p,1);newTime=b.between(2,b),E(u(a),o/newTime,20)}},E=function(a,b,c){var d=new Date,e=0|Math.sqrt(0|Math.abs(b)),f=b/e;!function b(e,g){var h=r(p,d)<0;e&&!h&&setTimeout(function(){C({pageY:a-f*g}),b(e-1,g+1)},c)}(e,1)};return c.on("mousedown touchstart",w).on("mouseup touchend",D).on("scroll mousewheel",v),C({pageY:0}),i.show(),{moveToSpace:function(a){w({pageY:0});var c=b.scrollTop-x[a-1];C({pageY:c});var d=j;j=!1,D({pageY:c}),j=d}}};
